

<div class="jobDetailLayout">

  <section class="jobStatus">
   <header>
      Editing JOB ID: <%=@job.id%> (Status: <%=@jobstatus%>)
      <br>
      <% if @job.job_status != 2 %>       
        <a href="javascript:void(0)" onclick="activateJob(<%=@job.id%>)" >
          <span class="btn btn-primary" >Activate this Job</span>
        </a>
      <% end %>
      <a href="javascript:void(0)" onclick="cancelJob(<%=@job.id%>)" >
        <span class="btn btn-primary">Cancel this Job</span>
      </a>
    </header>
    <% if @job.job_status != 2 %>
      <div class="Instructions">
        <p>Please ensure that you have all information properly keyed in before activating this job. </p>
        <p>Once activated, you will not be able to make changes to some of the fields</p>
      </div>
    <% end %>
    <% if @job.job_status == 2 %>
      <div class="Instructions">
        <p>This is an Active Job. No modification of information will be allowed. You cancel this job and post a new one if you need to make any modifications</p>
      </div>
    <% end %>
    <div id="jobdetailfocus"> </div>

  <section class="contactInfo">
    <header>
      Contact Information
    </header>
    <p>
      Contact Person:
      <a class="inputText" href="javascript:void(0)"  id="job_contactname" data-name="job_contactname" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Contact Person"><%= @job.job_contactname %>   </a>
    </p>
    <p>
      Contact Email:
      <a class="inputText" href="javascript:void(0)"  id="job_contactemail" data-name="job_contactemail" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Contact Email"><%= @job.job_contactemail %>   </a>
    </p>
    <p>
      Phone #: 
      <a class="inputText" href="javascript:void(0)"  id="job_contactphone" data-name="job_contactphone" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Contact Number"><%= @job.job_contactphone %> </a>
    </p>  
  </section>
              
  <section class="CV">
    <span id="CVsection"> 
      <a id="displaycv" style="visibility: visible;" href=<%= @job.job_jdurl %> target="_blank"> 
        <i class="fa fa-file-text-o"><br>JD</i> 
      </a>
    </span>
              
    <script src='_/js/jqueryfileupload/jquery.ui.widget.js' type='text/javascript'></script>
    <script src='_/js/jqueryfileupload/jquery.iframe-transport.js' type='text/javascript'></script>
    <script src='_/js/jqueryfileupload/jquery.fileupload.js' type='text/javascript'></script>
    <script src='_/js/jqueryfileupload/jquery.fileupload-process.js' type='text/javascript'></script>
    <script src='_/js/jqueryfileupload/jquery.fileupload-validate.js' type='text/javascript'></script>
    <script src='_/js/cloudinary/jquery.cloudinary.js' type='text/javascript'></script>
    <script type="text/javascript">$.cloudinary.config({cloud_name:'dashy', api_key:'219441847515364'}); </script>

    <span class="btn btn-primary fileinput-button">
      <div id="uploadprogress">
        <i class="glyphicon glyphicon-plus"></i> 
        Update JD file
      </div> 
      <input name="file" type="file" id="fileupload" class="cloudinary-fileupload" data-cloudinary-field="image_upload" >
    </span>
    <script type="text/javascript">
      $(function(){
        $('#fileupload').fileupload({
            add: function (e, data) {
                $.getJSON('/filer_jd', {pk: <%=@job.id %> }, function (result) {  
                    data.formData = result; // e.g. {id: 123}
                    data.submit();
                }).fail( function(d, textStatus, error) {
                    console.error("Error! Please contact helpdesk. Status: " + textStatus + ", error: "+error)
                });
            },
            url: "https://api.cloudinary.com/v1_1/dashy/upload",
            acceptFileTypes: /(\.|\/)(doc?x|pdf|txt)$/i, 
            // The maximum allowed file size in bytes:
            maxFileSize: 10000000, // 10 MB
            // The minimum allowed file size in bytes:
            minFileSize: 1, // No minimal file size
            // The limit of files to be uploaded:
            maxNumberOfFiles: 10
          })
        });

        $('.cloudinary-fileupload').bind('cloudinarydone', function(e, data) { 
           $.ajax({
                url: '/jduploaded',
                type: 'POST',
                data: {"jdurl": data.result.url, "pk" : <%=@job.id %>},
                success: function(response){
                  tt = "<a id='displaycv' style='visibility: visible'; href=".concat(data.result.url,"><i style='font-size: 25px;' class='fa fa-file-text-o'><br><div style='font-size: 14px;left:-10px;position:relative'>JD</div></i></a>");
                  $('#CVsection').html(tt);
                                  
                  $("#uploadprog").html("Uploading is complete!");
                  $('#uploadprog').fadeOut(3000, function() {
                    $(this).remove();
                    $("#uploadprogress").html("<i class='glyphicon glyphicon-plus'></i> <span >Upload new CV</span>");
                   });
                }
           }); //ajax
           return true;
        }); //cloudinary done

        $('.cloudinary-fileupload').bind('fileuploadprogress', function(e, data) {
          $("#uploadprogress").html("<div id='uploadprog'> <i class='fa fa-spinner fa-spin'></i>Uploading in progress</div> </div>");
        });

        $('.cloudinary-fileupload').bind('fileuploadstop', function(e, data) {

        });

         $('.cloudinary-fileupload').bind('fileuploadfail', function(e, data) {
            alert(data.files[0].error);
        });
    </script>
  </section> <!--CV-->

  <!-- If status is not Active -->
    <% if @job.job_status != 2 %>
      <section class="jobDetailLeft">
        <header>
          Job Detail
        </header>
        <div class="Instructions">
          <p>Job Title, Job Function and Job Industry: If you can't find what you need in the drop down list, please contact us to request for your title, function and industry to be added : support@jorb.co</p>
        </div>    
        <p>
          Closing Date:
          <input readonly="true" type="text" name="date-range-picker" id="id-date-range-picker-1" data-id=<%=@job.id%> value="<%=@job_closed %>"></input>      
        </p>
        <p>
          Job Title:
          <a class="inputText" href="javascript:void(0)"  id="job_title_actual" data-name="job_title_actual" data-type="text"  data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job Title" data-value="<%=@job.job_title_actual%>" >   </a>
        </p>
        <p>
          Job Position:
          <a class="inputText" href="javascript:void(0)"  id="job_title" data-name="job_title" data-type="select"  data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job Title" data-value="<%= @job.job_title%>" >   </a>
        </p>
        <p>
          Job Function:
          <a class="inputText" href="javascript:void(0)"  id="job_function" data-name="job_function" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job Function" data-value="<%= @job.job_function %> ">  </a>
        </p>
        <p>
          Related Experience: 
          <a class="inputText" href="javascript:void(0)"  id="job_experience" data-name="job_experience" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter years of related experience"><%= @job.job_experience %> </a> years
        </p>
        <p>
          Job Location:
          <a class="inputText" href="javascript:void(0)"  id="job_location" data-name="job_location" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job Location" data-value="<%= @job.job_location %>" >   </a>
        </p>
        <p>
          Job Industry:
          <a class="inputText" href="javascript:void(0)"  id="job_industry" data-name="job_industry" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job Industry" data-value="<%= @job.job_industry %>" >  </a>
        </p>

        <p>
          Travel Requirement:
          <a class="inputText" href="javascript:void(0)"  id="job_travel" data-name="job_travel" data-source="[{value: 0, text: '0%'}, {value: 25, text: '25%'}, {value: 50, text: '50%'}, {value: 75, text: '75%'}, {value: 100, text: '100%'}]" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Travel Requirement"><%= @job.job_travel.to_s+"%" %>   </a>
        </p>
      </section> <!--jobDetailLeft-->

      <section class="jobDetailRight">
        <p>
          No preference on Nationality?
          <input  onclick="nationalityallcheck(this,<%=@job.id%>)" id="nationalityallcheck" name="job_nationalityall" type="checkbox"  <%= @job.job_nationalityall== true ? "checked" : "unchecked" %> /> 
          <label for="nationalityallcheck"></label>
        </p>

        <p id="displaynationality"  style="visibility: visible;">
          Preferred Nationality :
          <a class="inputText" href="javascript:void(0)"  id="job_nationality" data-name="job_nationality" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Select Nationality Requirement"  > <%=@nationalitymaster%></a>
        </p>

        <p>
          PR may also apply
          <input  onclick="nationalityprcheck(this,<%=@job.id%>)" id="nationalityprcheck" name="job_nationalitypr" type="checkbox"  <%= @job.job_nationalitypr== true ? "checked" : "unchecked" %> />
          <label for="nationalityprcheck"></label>
        </p>

        <p>
          Minimum Salary: S$
          <a class="inputText" href="javascript:void(0)" id="job_salarymin" data-name="job_salarymin" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Minimum Salary SGD$:"><%= @job.job_salarymin.to_s %>   </a>per month
        </p>
        <p>
          Maximum Salary: S$
          <a class="inputText" href="javascript:void(0)"  id="job_salarymax" data-name="job_salarymax" data-type="text" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Maximum Salary SGD$:"><%= @job.job_salarymax.to_s %>   </a> per month
        </p>
                 
        <p>
          Employment Type:
          <a class="inputText" href="javascript:void(0)"  id="job_time" data-name="job_time" data-type="select" data-pk="<%=@job.id %>" data-url="/updatejob" data-title="Enter Job type" data-value=<%= @job.job_time %>  > </a>
        </p>

        <p>
          Must be willing to work after office hour
          <input  onclick="workemergencycheck(this,<%=@job.id%>)" id="workemergencycheck" name="job_workemergency" type="checkbox"  <%= @job.job_workemergency== true ? "checked" : "unchecked" %> /> <label for="workemergencycheck"></label>
        </p>
      </section> <!--jobDetailRight-->

      <section class="jobRequirement">
          <header>
            Job Requirement
          </header>
          <div class="Instructions">
            <h3>Requirements Gathering</h3>
            <p>Skills: Add all relevant skills and their expected level of expertise. Jorb.co matches only candidates with the best fit </p>
            <p>Languages: What's the spoken and written languages and their expertise level</p>
            <p>Education: What are the various educations that the candidates must go through. You can indicate if you have very strong preference (mandatory) for a particular education, or simply nice to have.</p>
            <p>Certificates: What are the professional certificates that the candidates must possess for this role</p>
            <p> If you can't find any of your skills/languages/education/certificates from the respective drop-down menu, please request to have them added by writing to support@jorb.co</p>
          </div> <!--Instrictions-->
          <!-- <div class="loading"> </div> -->

          <ul class="nav nav-tabs"> 
            <li class="active"><a id="skilltabclick" data-toggle="tab" href="#skilltab"> Skills Requirement</a></li>   
            <li><a id="languagetabclick" data-toggle="tab" href="#languagetab"> Languages Requirement</a></li>         
            <li><a id="edutabclick" data-toggle="tab" href="#edutab"> Education Requirement</a></li>   
            <li><a id="certtabclick" data-toggle="tab" href="#certtab"> Certificate Requirement</a></li>               
          </ul>
          <div class="tab-content">
            <div id="skilltab" class="tab-pane active">
              <div id="skilltable">  
                <a href="#addskillmodal" data-toggle="modal" data-keyboard="false" data-backdrop="static" role="button">
                    <span class="btn dark-blue-btn btn-primary">Add New Skill Requirement</span>
                </a>
                <div id="st"> <!-- Skill management table will be loaded in this div --></div>
              </div> <!-- skilltable -->
            </div> <!-- skilltab -->
                  
            <div id="languagetab" class="tab-pane">
              <div id="languagetable">
                <a href="#addlanguagemodal" data-toggle="modal" data-keyboard="false" data-backdrop="static" role="button">
                    <span class="btn dark-blue-btn btn-primary">Add New Language Requirement</span>
                </a>
                <div id="lt"><!-- Skill management table will be loaded in this div --></div>
              </div> <!-- languagetable -->
            </div> <!-- languagetab -->
                  

            <div id="edutab" class="tab-pane">
              <div id="edutable">
                <a href="#addedumodal" data-toggle="modal" data-keyboard="false" data-backdrop="static" role="button">
                    <span class="btn dark-blue-btn btn-primary">Add New Education Requirement</span>
                </a>
                <div id="et"><!-- Education management table will be loaded in this div --></div>
              </div> <!-- edutable -->
            </div> <!-- edutab -->

            <div id="certtab" class="tab-pane">
                  <div id="certtable">
                    <a href="#addcertmodal" data-toggle="modal" data-keyboard="false" data-backdrop="static" role="button">
                        <span class="btn dark-blue-btn btn-primary">Add New Certification Requirement</span>
                    </a>
                    <div id="ct"><!-- Certificate management table will be loaded in this div --></div>
                  </div> <!-- certtable" -->
            </div> <!-- certtab -->
          </div> <!-- tab-content-->  
      </section> <!--jobRequirement--> 
    <%end%>

  <!-- If status is Active -->
    <% if @job.job_status == 2 %>
      <section class="jobDetailLeft">
        <header>
          Job Detail
        </header>
        <p>
          Closing Date:
          <%=@job_closed %> 
        </p>
        <p>
          Job Title:
          <%=@job.job_title_actual%>
        </p>
        <p>
          Job Position:
          <% if @job.job_title !=nil %>
            <%= @titleMaster.get(@job.job_title).title%> 
          <%end%>
        </p>
        <p>
          Job Function:
          <% if @job.job_function !=nil %>
            <%= @functionMaster.get(@job.job_function).function %>
          <%end%>
        </p>
        <p>
          Related Experience: 
          <%= @job.job_experience %> years
        </p>
        <p>
          Job Location:
          <% if @job.job_location !=nil %>
            <%= @locationMaster.get(@job.job_location).country %>
          <%end%>
        </p>
        <p>
          Job Industry:
          <% if @job.job_industry !=nil %>
            <%= @industryMaster.get(@job.job_industry).industry %>
          <%end%>

        </p>

        <p>
          Travel Requirement:
          <%= @job.job_travel.to_s+"%" %>
        </p>
      </section> <!--jobDetailLeft-->

      <section class="jobDetailRight">
        <p>
          No preference on Nationality?
          <input  onclick="nationalityallcheck(this,<%=@job.id%>)" id="nationalityallcheck" name="job_nationalityall" type="checkbox"  <%= @job.job_nationalityall== true ? "checked" : "unchecked" %> disabled/> 
          <label for="nationalityallcheck"></label>
        </p>

        <p id="displaynationality"  style="visibility: visible;">
          Preferred Nationality :
            <%= @job.job_nationalityall== true ? "NA" : @nationalitymaster %>
        </p>

        <p>
          PR may also apply
          <input  onclick="nationalityprcheck(this,<%=@job.id%>)" id="nationalityprcheck" name="job_nationalitypr" type="checkbox"  <%= @job.job_nationalitypr== true ? "checked" : "unchecked" %> disabled/>
          <label for="nationalityprcheck"></label>
        </p>

        <p>
          Minimum Salary: S$
          <%= @job.job_salarymin.to_s %> per month
        </p>
        <p>
          Maximum Salary: S$
          <%= @job.job_salarymax.to_s %> per month
        </p>
                 
        <p>
          Employment Type:
          <%= @workMaster.get(@job.job_time).worktime %>
        </p>

        <p>
          Must be willing to work after office hour
          <input  onclick="workemergencycheck(this,<%=@job.id%>)" id="workemergencycheck" name="job_workemergency" type="checkbox"  <%= @job.job_workemergency== true ? "checked" : "unchecked" %> disabled/> <label for="workemergencycheck"></label>
        </p>
      </section> <!--jobDetailRight-->

      <section class="jobRequirement">
          <header>
            Job Requirement
          </header>
          <!-- <div class="loading"> </div> -->

          <ul class="nav nav-tabs"> 
            <li class="active"><a id="skilltabclick" data-toggle="tab" href="#skilltab"> Skills Requirement</a></li>   
            <li><a id="languagetabclick" data-toggle="tab" href="#languagetab"> Languages Requirement</a></li>         
            <li><a id="edutabclick" data-toggle="tab" href="#edutab"> Education Requirement</a></li>   
            <li><a id="certtabclick" data-toggle="tab" href="#certtab"> Certificate Requirement</a></li>               
          </ul>
          <div class="tab-content">
            <div id="skilltab" class="tab-pane active">
              <div id="skilltable">  

                <div id="st"> <!-- Skill management table will be loaded in this div --></div>
              </div> <!-- skilltable -->
            </div> <!-- skilltab -->
                  
            <div id="languagetab" class="tab-pane">
              <div id="languagetable">
                <div id="lt"><!-- Skill management table will be loaded in this div --></div>
              </div> <!-- languagetable -->
            </div> <!-- languagetab -->
                  

            <div id="edutab" class="tab-pane">
              <div id="edutable">
                <div id="et"><!-- Education management table will be loaded in this div --></div>
              </div> <!-- edutable -->
            </div> <!-- edutab -->

            <div id="certtab" class="tab-pane">
                  <div id="certtable">
                    <div id="ct"><!-- Certificate management table will be loaded in this div --></div>
                  </div> <!-- certtable" -->
            </div> <!-- certtab -->
          </div> <!-- tab-content-->  
      </section> <!--jobRequirement--> 
    <%end%>


</div> <!-- jobDetailLayout -->


<div class="modal fade" id="addskillmodal" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <header>Skill Requirement</header>                                                           
      </div> <!-- "modal-header" -->
      <div class="modal-body">  
        <div class="Instructions">
          <p> If your skills are not listed, please request to have them added by writing to support@jorb.co</p>
        </div> <!--Instrictions-->
        <div id = "alert_placeholder-inmodal"></div>
        <p>
          Skill category
          <a href="#" class="newskill inputText" id="skillcat" data-emptytext="Select..." data-type="select"  data-name="id"  data-original-title="Select skill category"></a>
        </p>
        <p>
          Skill name
          <a href="#" class="newskill inputText" id="skillname"  data-emptytext="Select..." data-type="select" data-name="skillid" data-original-title="Select skill"></a>
        </p>
        <p>
          Skill rank
          <a href="#" class="newskill inputText" id="skillrank" data-emptytext="Select..." data-type="select" data-name="skillrank" data-source="[{value: 2, text: 'Basic'}, {value: 3, text: 'Intermediate'}, {value: 4, text: 'Advance'}, {value: 5, text: 'Expert'}]" data-original-title="Select rank"></a>
        </p>
 
      </div> <!-- "modal-body" -->
      <div class="modal-footer">
        <button id="saveskill-btn" class="btn btn-primary">
          Save and Add more Skill Requirement
        </button>
      </div> <!-- footer --> 
    </div> <!-- modal-content -->
  </div><!-- modal-dialog -->
</div><!-- addskillmodal  -->

<div class="modal fade" id="addlanguagemodal" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <header>Language Requirement</header>                                                            
      </div> <!-- "modal-header" -->
      <div class="modal-body">   
        <div class="Instructions">
          <p> If the language that you are looking for is not listed, please request to have them added by writing to support@jorb.co</p>
        </div> <!--Instrictions-->
        <div id = "alert_placeholder-inmodal2"></div>
        <p>
          Language
          <a href="#" class="newlang inputText" id="job_lang"  data-emptytext="Select..." data-type="select" data-name="job_lang" data-original-title="Select language"></a>
        </p>
        <p>
          Spoken skill level
          <a href="#" class="newlang inputText" id="job_lang_speakskill" data-emptytext="Select..." data-type="select" data-name="job_lang_speakskill" data-source="[{value: 2, text: 'Basic'}, {value: 3, text: 'Intermediate'}, {value: 4, text: 'Advance'}, {value: 5, text: 'Expert'}]" data-original-title="Select rank"></a>
        <p>
        <p>
          Written skill level
          <a href="#" class="newlang inputText" id="job_lang_writeskill" data-emptytext="Select..." data-type="select" data-name="job_lang_writeskill" data-source="[{value: 2, text: 'Basic'}, {value: 3, text: 'Intermediate'}, {value: 4, text: 'Advance'}, {value: 5, text: 'Expert'}]" data-original-title="Select rank"></a>
        </p>
      </div> <!-- "modal-body" -->
      <div class="modal-footer">
        <button id="savelanguage-btn" class="btn btn-primary">Save and Add more Language Requrement</i></button>
      </div> <!-- footer -->
    </div> <!-- modal-content -->
  </div><!-- modal-dialog -->
</div><!-- addlanguagemodal  --> 

<div class="modal fade" id="addedumodal" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <header>Education Requirement</header>                                                            
      </div> <!-- "modal-header" -->
      <div class="modal-body">   
        <div class="Instructions">
          <p> If the title, institutions, speciality and honors that you require is not listed, please request to have them added by writing to support@jorb.co</p>
        </div> <!--Instrictions-->
        <div id = "alert_placeholder-inmodal3"></div>
        <p>
          Title
          <a href="#" class="newedu inputText" id="job_edu_title"  data-emptytext="Select..." data-type="select" data-name="job_edu_title" data-original-title="Select Title"></a>
        </p>
        <p>  
          Specialty
          <a href="#" class="newedu inputText" id="job_edu_specialty" data-emptytext="Select..." data-type="select" data-name="job_edu_specialty" data-original-title="Select Specialty"></a>
        </p>
        <p>  
          Honors
          <a href="#" class="newedu inputText" id="job_edu_honors" data-emptytext="Select..." data-type="select" data-name="job_edu_honors" data-original-title="Select Honors"></a>
        </p>  
        <p>  
          How important is this for the job?
          <a href="#" class="newedu inputText" id="job_edu_pref" data-emptytext="Select..." data-type="select" data-name="job_edu_pref" data-original-title="Select Honors"></a>
        </p>  
      </div> <!-- "modal-body" -->
      <div class="modal-footer">
        <button id="saveedu-btn" class="btn btn-primary">
          Save and Add more Education Requirement
        </button>
      </div> <!-- footer -->
    </div> <!-- modal-content -->
  </div><!-- modal-dialog -->
</div><!-- addedumodal  --> 

<div class="modal fade" id="addcertmodal" >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <header>Certification Requirement</header>                                                            
        </div> <!-- "modal-header" -->
        <div class="modal-body">   
          <div class="Instructions">
          <p> If your certification is not listed, please request to have them added by writing to support@jorb.co</p>
        </div> <!--Instrictions-->
          <div id = "alert_placeholder-inmodal4"></div>
          <p>
            Certificate Name
            <a href="#" class="newcert inputText" id="job_cert_title"  data-emptytext="Select..." data-type="select" data-name="job_cert_title" data-original-title="Select Title"></a>
          </p>
          <p>
            How important is this important for the job?
            <a href="#" class="newcert inputText" id="job_cert_pref"  data-emptytext="Select..." data-type="select" data-name="job_cert_pref" data-original-title="Select Title"></a>
          </p>
        </div> <!-- "modal-body" -->
        <div class="modal-footer">
          <button id="savecert-btn" class="btn btn-primary">
            Save and Add more Certification Requirement
          </button>
        </div> <!-- footer -->
      </div> <!-- modal-content -->
    </div><!-- modal-dialog -->
</div><!-- addcertmodal  --> 



<script>
  $(function(){

    //$("#st").html("<div id='loader'><i class='fa fa-spinner fa-spin'></i>Loading Skill Requirement Table now... </div>"); 
    // $("#lt").html("<div id='loading'><i class='fa fa-spinner fa-spin'></i>Loading Language Requirement Table now... </div>"); 
    // $("#loading").html("<div class='spinner'></div>");
    // $("#et").html("<div id='loading'><i class='fa fa-spinner fa-spin'></i>Loading Education Requirement Table now... </div>"); 
    // $("#ct").html("<div id='loading'><i class='fa fa-spinner fa-spin'></i>Loading Certification Requirement Table now... </div>"); 

    // X-Editables Setup
      

        $('#job_title').editable({
          source: "/getjobtitle",
          emptytext: '--',
        });

        $('#job_location').editable({
          source: "/getcountries",
          emptytext: '--',
         });
            
        $('#job_industry  ').editable({
          source: "/getind",
          emptytext: '--',
         });

        $('#job_travel').editable({
          emptytext: '--',
         });

        $('#job_salarymin').editable({
          emptytext: '--',
         });

        $('#job_salarymax').editable({
            emptytext: '--',
         });

        $('#job_experience').editable(
        {
            emptytext: '--',
        });

        $('#job_time').editable(
        {
            source: "/getworktime",
            emptytext: '--',
        });

        $('#job_function').editable({
          source: "/getfunction",
          emptytext: '--',
         });

        $('#skilltable').editable({
          selector: 'a.skillrank',
          showbuttons: false
        });

        $('#languagetable').editable({
          selector: 'a.job_lang_speakskill',
          showbuttons: false
        });

        $('#languagetable').editable({
          selector: 'a.job_lang_writeskill',
          showbuttons: false
        });

        $('#edutable').editable({
          selector: 'a.job_edu_pref',
          source: "/getpref",
          showbuttons: false
        });// edutable

        $('#certtable').editable({
          selector: 'a.job_cert_pref',
          source: "/getpref",
          showbuttons: false
        }); //certtable

        $('#job_edu_pref').editable({
          source: "/getpref",
          disabled: false,
          onblur: 'submit',
          showbuttons: false
        }); //job_edu_pref

        $('#job_cert_pref').editable({
          source: "/getpref",
          disabled: false,
          onblur: 'submit',
          showbuttons: false
        }); //job_cert_pref

    // X-Editable for Add Skill Modal 
      $('#skillcat').editable({
        source: "/getskillcat" ,
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue) {

                 $.getJSON("/getskill", {"value": newValue}, function (result) {
                  $('#skillname').editable('option', 'source', result);   //somehow, all these 3 sentences must be in here.
                  $('#skillname').editable('setValue', null);             //else it will fail.
                  $('#skillname').editable('option', 'disabled', false);  //             
                  }).fail( function(d, textStatus, error) {
                      console.error("Error code: " + textStatus + ", error: "+error)

                  });
        }
      });

      $('#skillname').editable({
        disabled: true,
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue)
        {
          $('#skillrank').editable('option', 'disabled', false);
        }
        });

      $('#skillrank').editable(
        {
        disabled: true,
        onblur: 'submit',
        showbuttons: false});

    // X-Editable for Add Language Modal
      $('#job_lang').editable({
        source: "/getlanguage",
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue) {
           $('#job_lang_speakskill').editable('option', 'disabled', false);
        }
      }); //lang

      $('#job_lang_speakskill').editable({
        disabled: true,
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue)
        {
          $('#job_lang_writeskill').editable('option', 'disabled', false);
        }
      }); //speakskill

      $('#job_lang_writeskill').editable(
        {
        disabled: true,
        onblur: 'submit',
        showbuttons: false});

    // X-Editable for Add Education Modal
      $('#job_edu_title').editable({
        source: "/getdegree",
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue) {
           $('#job_edu_specialty').editable('option', 'disabled', false);
           if (newValue ==1 || newValue == 2 || newValue ==3) {
              $('#job_edu_honors').editable('option', 'disabled', true);
              $('#job_edu_specialty').editable('option', 'disabled', true);
           }else {
            $('#job_edu_honors').editable('option', 'disabled', false);
            $('#job_edu_specialty').editable('option', 'disabled', false);
           }
        }
      }); //job_edu_title

      $('#job_edu_specialty').editable({
        source: "/getspecialty",
        disabled: false,
        onblur: 'submit',
        showbuttons: false,
        success: function(response, newValue)
        {

        } //success
      }); //job_edu_specialty

      $('#job_edu_honors').editable({
          source: "/gethonors",
          disabled: false,
          onblur: 'submit',
          showbuttons: false,
          success: function(response, newValue)
          {
            $('#job_edu_pref').editable('option', 'disabled', false);
          }
      });//job_edu_honors

    // X-Editable for Add Certification Modal
        $('#job_cert_title').editable({
          source: "/getcert",
          onblur: 'submit',
          showbuttons: false,
          success: function(response, newValue) {
          } //success
        }); //job_cert_title



    if (<%=@job.job_jdurl== ''%>  ){
      document.getElementById( 'displaycv' ).style.visibility = 'hidden';
      console.log("hidden");
    }
      else {
        document.getElementById( 'displaycv' ).style.visibility = 'visible';
        console.log("visible");
    };

    if (<%=@job.job_nationalityall%>){
      $('#job_nationality').editable('option', 'disabled', true);
      document.getElementById("nationalityprcheck").disabled = true;
      // document.getElementById("job_nationality").style.color = "#DDE1DD";
      $("#infobox").html("Anyone can apply for this job"); 
    } else {
      $('#job_nationality').editable(
      {
        source: "/getcountries",
        emptytext: '--',
      });
      $('#job_nationality').editable('option', 'disabled', false);
      document.getElementById("nationalityprcheck").disabled = false;
      // document.getElementById("job_nationality").style.color = "#555";
      $("#infobox").html("Only citizens from the chosen country can apply. You can also allow/disallow PR from that chosen country from apply (which means only citizen can apply");
    }
   
    $("#st").load("/j_table",{i: new Date().getTime(), pk: <%=@job.id%>}, function(){
      $('.spinner').fadeOut(1000, function() {$(this).remove();});
    });  
  }); //function()
</script>


<script>
  
  // POST LOADING START Loading the respective tables when user click on the tab
    $('#skilltabclick').one("click", function() {
      $("#loading").html("<div class='spinner'></div>");
        $("#st").load("/j_table",{i: new Date().getTime(), pk: <%=@job.id%>}, function(){
          $('.spinner').fadeOut(1000, function() {$(this).remove();});
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
        });  
    });

    $('#languagetabclick').one("click", function() {
      $("#loading").html("<div class='spinner'></div>");
        $("#lt").load("/j_langtable",{i: new Date().getTime(), pk: <%=@job.id%>}, function(){
          $('.spinner').fadeOut(1000, function() {$(this).remove();});
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
            
        }); 
    });

    $('#edutabclick').one("click", function() {
        $("#loading").html("<div class='spinner'></div>");
        $("#et").load("/j_edutable",{i: new Date().getTime(), pk: <%=@job.id%>}, function(){
          $('.spinner').fadeOut(1000, function() {$(this).remove();});
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
        }); 
    });
    $('#certtabclick').one("click", function() {
        $("#loading").html("<div class='spinner'></div>");
        $("#ct").load("/j_certtable",{i: new Date().getTime(), pk: <%=@job.id%>}, function(){
          $('.spinner').fadeOut(1000, function() {$(this).remove();});
            $("html, body").animate({ scrollTop: $(document).height() }, "slow");
        }); 
    });

  // SAVE and CLOSE BUTTONS 
    $('#saveskill-btn').click(function() {
       $('.newskill').editable('submit', {
         url: '/j_newskill',
         data: {"pk" : <%=@job.id%>},
         ajaxOptions: {
             dataType: 'json' 
         },       
         success: function(data, config) {
         
              if(data && data.errors){
                   //server-side validation error, response like {"errors": {"username": "username already exist"} }
                   //config.error.call(this, data.errors);
                   newAlert("#alert_placeholder-inmodal",'danger', data.errors);
             }   else{

                  newAlert("#alert_placeholder-inmodal",'success', data.responsemsg);

                  $('.newskill').editable('setValue', null);  //clear values
                  $('#skillname').editable('option', 'disabled', true);
                  $('#skillrank').editable('option', 'disabled', true);
                  $("#st").load("/j_table",{i: new Date().getTime(), pk: <%=@job.id%>});
             }   
         },
           error: function(errors) {
               var msg = '';
               if(errors && errors.responseText) { //ajax error, errors = xhr object
                   msg = errors.responseText;
                   //We do not have any response text from backend at the moment
               } else { //validation error (client-side or server-side)
                   $.each(errors, function(k, v) {
                    if (k=="skillcatid") {k = "Skill Category"};
                    if (k=="skillid") {k = "Skill name"};
                    if (k=="skillrank") {k = "Skill rank"};     
                    msg += k+": "+v+"<br>";
                  });
                   newAlert("#alert_placeholder-inmodal",'danger', msg);
               } //else
           } //error
       }); //newskill
    }); //saveskill-btn

    $('#closeskill-btn').click(function() {
      $('.newskill').editable('setValue', null)  //clear values
          .editable('option', 'pk', null)          //clear pk
          .removeClass('editable-unsaved');        //remove bold css
    }); //closeskill-btn

    $('#savelanguage-btn').click(function() {
        $('.newlang').editable('submit', {
          url: '/j_newlanguage',
          data: {"pk" : <%=@job.id%>},
          ajaxOptions: {
             dataType: 'json' //assuming json response
          },       
          success: function(data, config) {          
            if(data && data.errors){
                 //server-side validation error, response like {"errors": {"username": "username already exist"} }
                 //config.error.call(this, data.errors);
                 newAlert("#alert_placeholder-inmodal2",'danger', data.errors);

            } else {
              newAlert("#alert_placeholder-inmodal2",'success', 'New Language added!');
              $('.newlang').editable('setValue', null);  //clear values
              $('#job_lang_speakskill').editable('option', 'disabled', true);
              $('#job_lang_writeskill').editable('option', 'disabled', true);
              // $("#lt").load("/langtable");
              $("#lt").load("/j_langtable",{i: new Date().getTime(), pk: <%=@job.id%>}); 
            } //else 
          },
          error: function(errors) {
            var msg = '';
            if(errors && errors.responseText) { //ajax error, errors = xhr object
               msg = errors.responseText;
               //We do not have any response text from backend at the moment
            } else { //validation error (client-side or server-side)
               $.each(errors, function(k, v) {
                if (k=="job_lang") {k = "Language"};
                if (k=="job_lang_speakskill") {k = "Spoken skill level"};
                if (k=="job_lang_writeskill") {k = "Written skill level"};     
                msg += k+": "+v+"<br>";
              });
               newAlert("#alert_placeholder-inmodal2",'danger', msg);
            } //else
          } //error
        }); //newlang
    }); //savelanguage-btn

    $('#closelanguage-btn').click(function() {
      $('.newlang').editable('setValue', null)  //clear values
          .editable('option', 'pk', null)          //clear pk
          .removeClass('editable-unsaved');        //remove bold css
    }); //closelanguage-btn

    $('#saveedu-btn').click(function() {
      $('.newedu').editable('submit', {
        url: '/j_newedu',
        data: {"pk" : <%=@job.id%>},
        ajaxOptions: {
           dataType: 'json' //assuming json response
        },       
        success: function(data, config) {
          if(data && data.errors){
            newAlert("#alert_placeholder-inmodal3",'danger', data.errors);
          } else{
            newAlert("#alert_placeholder-inmodal3",'success', 'New Education Requirement Added!');
            $('.newedu').editable('setValue', null);  //clear values
            $('#job_edu_specialty').editable('option', 'disabled', false );
            $('#job_edu_honors').editable('option', 'disabled', false);
            $("#et").load("/j_edutable",{i: new Date().getTime(), pk: <%=@job.id%>}); 
          } //else   
        }, //success
        error: function(errors) {
          var msg = '';
          if(errors && errors.responseText) { //ajax error, errors = xhr object
            msg = errors.responseText;
          } else { //validation error (client-side or server-side)
            $.each(errors, function(k, v) {
              if (k=="job_edu_title") {k = "Education title"};
              if (k=="job_edu_specialty") {k = "Specialty"};
              if (k=="job_edu_honors") {k = "Honors"};   
              if (k=="job_edu_pref") {k = "Preference level"};     
              msg += k+": "+v+"<br>";
            }); //each
            newAlert("#alert_placeholder-inmodal3",'danger', msg);
          } //else
        } //error
      }); //newedu
    }); //saveedu-btn

    $('#closeedu-btn').click(function() {
      $('.newedu').editable('setValue', null)  //clear values
      .editable('option', 'pk', null)          //clear pk
      .removeClass('editable-unsaved');        //remove bold css
    }); //closeedu-btn

    $('#savecert-btn').click(function() {
       $('.newcert').editable('submit', {
           url: '/j_newcert',
           data: {"pk" : <%=@job.id%>},
           ajaxOptions: {
               dataType: 'json' //assuming json response
           },       
           success: function(data, config) {
                if(data && data.errors){
                     newAlert("#alert_placeholder-inmodal4",'danger', data.errors);
                } //if   
                else {
                  newAlert("#alert_placeholder-inmodal4",'success', 'New Certification Requirement Added!');
                  $('.newcert').editable('setValue', null);  //clear values
                  $("#ct").load("/j_certtable",{i: new Date().getTime(), pk: <%=@job.id%>}); 
                } //else
           }, //success
           error: function(errors) {
               var msg = '';
               if(errors && errors.responseText) { //ajax error, errors = xhr object
                   msg = errors.responseText;
               }  //if
               else { //validation error (client-side or server-side)
                   $.each(errors, function(k, v) {
                    if (k=="job_cert_title") {k = "Education title"};
                    if (k=="job_cert_pref") {k = "Preference level"};     
                    msg += k+": "+v+"<br>";
                  });
                   newAlert("#alert_placeholder-inmodal4",'danger', msg);
               } //else
           } //error
       }); //newcert
    }); //savecert-btn

    $('#closecert-btn').click(function() {
      $('.newcert').editable('setValue', null)  //clear values
          .editable('option', 'pk', null)          //clear pk
          .removeClass('editable-unsaved');        //remove bold css
    }); //closecert-btn

  // Delete functions for Tables 
    function deledu(element,i){
      if (<%=@job.job_status%> != 2){
        $.ajax({
          url: '/j_deleteedu',
          type: 'POST',
          data: {"pk" : i, "jobid" :<%=@job.id%>},
          success: function(response){
            var row=$(element).parents('tr')
            $('#edusettingtable').dataTable().fnDeleteRow(row[0]);
            newAlert("#alert_placeholder-tab", 'success', "Education Requirement Deleted!");
          }
        }); //ajax
      } else {
        alert ("This is an active job posting. No deletion is allowed");
      }
    }//deledu

    function delcert(element,i){
      if (<%=@job.job_status%> != 2){
        $.ajax({
          url: '/j_deletecert',
          type: 'POST',
          data: {"pk" : i, "jobid" :<%=@job.id%>},
          success: function(response){
            var row=$(element).parents('tr')
            $('#certsettingtable').dataTable().fnDeleteRow(row[0]);
            newAlert("#alert_placeholder-tab", 'success', "Certification Requirement Deleted!");
          }
        }); //ajax
      } else {
        alert ("This is an active job posting. No deletion is allowed");
      }
    }//delcert

    function delskill(element,i){
      if (<%=@job.job_status%> != 2){
        $.ajax({
          url: '/j_deleteskill',
          type: 'POST',
          data: {"pk" : i, "jobid" :<%=@job.id%>},
          success: function(response){
            var row=$(element).parents('tr')
            $('#skillsettingtable').dataTable().fnDeleteRow(row[0]);
            newAlert("#alert_placeholder-tab", 'success', "Skill deleted!");
          } //success
        }); //ajax
      } else {
        alert ("This is an active job posting. No deletion is allowed");
      }
    }//delskill

    function dellanguage(element,i){
      if (<%=@job.job_status%> != 2){
        $.ajax({
          url: '/j_deletelanguage',
          type: 'POST',
          data: {"pk" : i, "jobid" :<%=@job.id%>},
          success: function(response){
            var row=$(element).parents('tr')
            $('#languagesettingtable').dataTable().fnDeleteRow(row[0]);
            newAlert("#alert_placeholder-tab", 'success', "Language deleted!");
          } //success
        }); //ajax
      } else {
        alert ("This is an active job posting. No deletion is allowed");
      }
    }//dellanguage

  // Checkbox mechanism
    function nationalityprcheck(a,i){
        $.ajax({
          url: '/updatenationalitypr',
          type: 'POST',
          data: {"job_nationalitypr": a.checked, "pk" : i},
        })
      }; //nationalityprcheck

    function workemergencycheck(a,i){
        $.ajax({
          url: '/updateemergencyhour',
          type: 'POST',
          data: {"job_workemergency": a.checked, "pk" : i},
        })
      }; //workemergencycheck

    function nationalityallcheck(a,i){
        $.ajax({
          url: '/updatenationalityall',
          type: 'POST',
          data: {"job_nationalityall": a.checked, "pk" : i},
          beforeSend : function(){
            $("#saving_intern").html("<div id='saver_i'><div id='saver_fulltime'><i class='fa fa-spinner fa-spin'></i></div>");
          },
          success: function(response){  
              obj = JSON.parse(response)
              if (obj.responsemsg){
                //document.getElementById( 'displaynationality' ).style.visibility = 'hidden';
                // $('#job_nationality').editable('toggleDisabled');
                $('#job_nationality').editable('option', 'disabled', true);
                document.getElementById("nationalityprcheck").disabled = true;
                // document.getElementById("t1").style.color = "DDE1DD"; 
                // document.getElementById("t2").style.color = "DDE1DD"; 
                document.getElementById("job_nationality").style.color = "#DDE1DD"; 
                $("#infobox").html("Anyone can apply for this job");
              } else {
                //document.getElementById( 'displaynationality' ).style.visibility = 'visible';
                // $('#job_nationality').editable('toggleDisabled');
                $('#job_nationality').editable(
                  {
                    source: "/getcountries",
                    emptytext: '--',
                  // placeholder: '[Optional] Enter your achievement here'
                 });
                $('#job_nationality').editable('option', 'disabled', false);
                document.getElementById("nationalityprcheck").disabled = false;
                // document.getElementById("t1").style.color = "#555"; 
                // document.getElementById("t2").style.color = "#555"; 
                document.getElementById("job_nationality").style.color = "#555"; 
                $("#infobox").html("Only citizens from the chosen country can apply. You can also allow/disallow PR from that chosen country from apply (which means only citizen can apply");
                       };                 
                 

             $('#saver_i').fadeOut(1000, function() {
             $(this).remove();
           });
          } //success function
        }); //ajax
    }; // nationalityallcheck

  // Alerts
    function newAlert (loc, type, message) {
        $(loc).append($("<div class='alert alert-block alert-" + type + " fade in' data-alert><p> " + message + " </p></div>"));
        $(".alert").delay(2000).fadeOut("slow", function () { $(this).remove(); });
    };     
</script>
